{"version":3,"file":"commonHelpers.js","sources":["../src/js/cart.js"],"sourcesContent":["export { cleanCart };\nimport axios from 'axios';\nimport { KEY_CART, cartArr, deleteFromCart } from './cart-localestorage';\nimport iconsSvg from '/img/icons.svg';\n\nconst refs = {\n  counterCart: document.querySelector('.js-cart-numbers'),\n  counterMainPage: document.querySelector('#cart-count'),\n  list: document.querySelector('.js-cart-list'),\n  cartEmpty: document.querySelector('.js-empty-cart'),\n  cartFull: document.querySelector('.cart-full'),\n  buttonDeleteProduct: '.delete-btn',\n  buttonCleanCart: document.querySelector('.js-delete-all-btn'),\n  formSubmit: document.querySelector('.form-cart'),\n  totalPrice: document.querySelector('.total-price'),\n  cartSuccess: document.querySelector('.js-success'),\n  closeSuccess: document.querySelector('.js-close-success'),\n  cartFormError: document.querySelector('.form-error'),\n  invalidEmail: document.querySelector('.js-invalid-email'),\n  closeInvalidEmail: document.querySelector('.js-close-invalid-email'),\n};\n\n//Функція наповнення кошика при оновленні сторінки\nfillCart();\n\nfunction fillCart() {\n  //Якщо масив cartArr з localeStorage не пустий, то відмальовуємо товари в кошику, інакше показуємо заглушку\n  if (cartArr.length !== 0) {\n    refs.cartEmpty.style.display = 'none';\n    refs.cartFull.style.display = 'flex';\n    refs.list.insertAdjacentHTML('beforeend', createCartMarkUp(cartArr));\n\n    //Викликаємо функцію оновлення загальної вартості товарів\n    updateTotal();\n\n    // Записуємо в лічильники кількість товарів в кошику\n    refs.counterCart.textContent = cartArr.length;\n    refs.counterMainPage.textContent = cartArr.length;\n  } else {\n    refs.cartEmpty.style.display = 'flex';\n    refs.cartFull.style.display = 'none';\n  }\n}\n\n//Функція оновлення загальної вартості товарів (Обчислюємо TOTAL)\nfunction updateTotal() {\n  const total = cartArr.reduce((previousValue, product) => {\n    return previousValue + product.price;\n  }, 0);\n  refs.totalPrice.innerHTML = total.toFixed(2);\n}\n\n//Розмітка картки в кошику\nfunction createCartMarkUp(arr) {\n  return arr\n    .map(({ _id, name, img, category, price, size }) => {\n      const cleanedCategory = category.replace(/_/g, ' ');\n\n      return `<li class=\"selectedProduct\" data-id=${_id}>\n            <div class=\"product-picture\">\n                <img src=\"${img}\" alt=\"${name}\" class=\"\" loading=\"lazy\" />\n            </div>\n\n            <div class=\"product-info-container\">\n\n            <div class=\"info-header\">\n                <h2 class=\"product-name\">${name}</h2>\n                <button class=\"delete-btn\">\n                    <svg class=\"\" width=\"20\" height=\"20\">\n                    <use href=\"${iconsSvg}#icon-x-close\"></use>\n                    </svg>\n                </button>\n            </div>\n\n            <div class=\"product-info\">\n                <p class=\"info-quality-category\"> Category: <span class=\"info-value\">${cleanedCategory}</span>\n                </p>\n                <p class=\"info-quality\"> Size:<span class=\"info-value\">${size}</span></p>\n            </div>\n            <div class=\"price\">$\n            <span>${price}</span>\n            </div>\n            </div>\n        </li>`;\n    })\n    .join('');\n}\n\n//Функція оновлення корзини при видалені 1 товару з корзини (функція deleteFromCart імпортується)\nfunction updateCartList() {\n  document.querySelectorAll(refs.buttonDeleteProduct).forEach(btn => {\n    btn.addEventListener('click', () => {\n      deleteFromCart(cartArr, btn);\n      // Оновлюємо розмітку та загальну вартість\n      refs.list.innerHTML = createCartMarkUp(cartArr);\n      updateCartList();\n      updateTotal();\n    });\n  });\n}\n\nupdateCartList();\n\n//По кліку на кнопву Delete all очищуємо корзину\nrefs.buttonCleanCart.addEventListener('click', cleanCart);\n\nfunction cleanCart() {\n  localStorage.removeItem(KEY_CART);\n\n  refs.cartEmpty.style.display = 'flex';\n  refs.cartFull.style.display = 'none';\n\n  // Щоб очистити лічильники і список,перезаписуємо пустий масив\n  refs.list.innerHTML = createCartMarkUp(cartArr);\n  document.querySelector('.js-cart-numbers').innerHTML = 0;\n  document.querySelector('#cart-count').innerHTML = 0;\n}\n\n//Відправлення замовлення на сервер через форму\nrefs.formSubmit.addEventListener('submit', handlerFormSubmit);\n\nasync function handlerFormSubmit(event) {\n  event.preventDefault();\n  const { email } = event.target.elements;\n\n  const valid = validateEmail(email.value);\n  if (!valid) {\n    openModalInvalidEmail();\n    return;\n  }\n  //Створимо функцію, яка за допомогою map створить новий масив обєктів (лише з властивостями productId i amount), який потрібно передати на сервер\n  function createProducts(cartArr) {\n    const products = cartArr.map(({ _id }) => {\n      const productId = _id;\n      const newProduct = {\n        productId,\n        amount: 1,\n      };\n      return newProduct;\n    });\n    return products;\n  }\n\n  //Створюємо обєкт для сервера з email покупця і масивом продуктів\n  const newOrder = {\n    email: email.value,\n    products: createProducts(cartArr),\n  };\n\n  // Показываем лоадер перед запросом\n  document.getElementById('overlay').style.display = 'flex';\n\n  await axios\n    .post('https://food-boutique.b.goit.study/api/orders', newOrder)\n    .then(data => {\n      // Скрываем лоадер после запроса\n      document.getElementById('overlay').style.display = 'none';\n      openModalSuccess();\n      refs.cartFormError.innerHTML = '';\n    })\n    .catch(err => {\n      console.error(err);\n      document.getElementById('overlay').style.display = 'none';\n      refs.cartFormError.innerHTML = `We had some error. Try again please.`;\n    });\n}\n\n//Валідація email\nfunction validateEmail(email) {\n  const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;\n  return emailPattern.test(email);\n}\n\n//Модальне вікно після успішного запиту на сервер\nfunction openModalSuccess() {\n  refs.cartSuccess.classList.remove('visually-hidden');\n  refs.closeSuccess.addEventListener('click', () => {\n    closeSuccessCart();\n  });\n}\n\n//Закриваємо модальне вікно і піднімаємося вверх\nfunction closeSuccessCart() {\n  setTimeout(scrollToTop, 500);\n  refs.cartSuccess.classList.add('visually-hidden');\n  refs.formSubmit.reset();\n  cleanCart();\n}\n\nfunction scrollToTop() {\n  window.scrollTo({\n    top: 0,\n    behavior: 'smooth', // Optional: Smooth scrolling animation\n  });\n}\n\n//Модальне вікно при введенні неправильного email\nfunction openModalInvalidEmail() {\n  refs.invalidEmail.classList.remove('visually-hidden');\n  refs.closeInvalidEmail.addEventListener('click', () => {\n    closeModalInvalidEmail();\n  });\n}\n\nfunction closeModalInvalidEmail() {\n  refs.invalidEmail.classList.add('visually-hidden');\n}\n"],"names":["refs","fillCart","cartArr","createCartMarkUp","updateTotal","total","previousValue","product","arr","_id","name","img","category","price","size","cleanedCategory","iconsSvg","updateCartList","btn","deleteFromCart","cleanCart","KEY_CART","handlerFormSubmit","event","email","validateEmail","openModalInvalidEmail","createProducts","newOrder","axios","data","openModalSuccess","err","closeSuccessCart","scrollToTop","closeModalInvalidEmail"],"mappings":"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"}